<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://momo1239.github.io/2024/pwnctf/" />
  
  <link rel="canonical" href="https://momo1239.github.io/2024/cve-2024/" />
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">

  <title>
       
       
           Lame ZeroDay Research: Stack Based Buffer Overflow in CVE-2024-XYZA | Kenny Nguyen (momo)
       
  </title>
  <meta name="title" content="Lame ZeroDay Research: Stack Based Buffer Overflow in CVE-2024-XYZA | Kenny Nguyen (momo)">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Lame ZeroDay Research: Stack Based Buffer Overflow in CVE-2024-XYZA"/>
<meta name="twitter:description" content="TLDR Checkout https://github.com/momo1239 for proof of concept inputs.
CVE-2024-XYZA A stack buffer overflow vulnerability exists in the charset handling functionality of html2xhtml version 1.3. An attacker can exploit this vulnerability by providing a specially crafted input, which would lead to the overflow of the &lsquo;buf&rsquo; variable located on the stack. Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code or crash the application, leading to denial of service."/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Lame ZeroDay Research: Stack Based Buffer Overflow in CVE-2024-XYZA",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/momo1239.github.io\/2024\/cve-2024\/"
  },
  
  "genre": "posts",
  "keywords": "vuln-research, buffer overflow, memory corruption",
  "wordcount":  1158 ,
  "url": "https:\/\/momo1239.github.io\/2024\/cve-2024\/",
  "datePublished": "2024-05-19T00:00:00\u002b00:00",
  "dateModified": "2024-05-19T00:00:00\u002b00:00",
  
  
  
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://momo1239.github.io/">Kenny Nguyen (momo)</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://momo1239.github.io/">Kenny Nguyen (momo)</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title">Lame ZeroDay Research: Stack Based Buffer Overflow in CVE-2024-XYZA</h1>
        <div class="post-meta">
            Written by <a href="https://momo1239.github.io/" rel="author">Momo</a> with ‚ô•
                <span class="post-time">
                    on <time datetime=2024-05-19 >19 May 2024</time>
                </span>
                in
                
                &nbsp;<i class="iconfont icon-timer"></i>
                6 min
        </div>
    </header>
    <div class="post-content">

        


        

        
            
        

        
        

          
          
          

          
          
          

          <h1 id="tldr">TLDR</h1>
<p>Checkout <a href="https://github.com/momo1239">https://github.com/momo1239</a> for proof of concept inputs.</p>
<h1 id="cve-2024-xyza">CVE-2024-XYZA</h1>
<p>A stack buffer overflow vulnerability exists in the charset handling functionality of html2xhtml version 1.3. An attacker can exploit this vulnerability by providing a specially crafted input, which would lead to the overflow of the &lsquo;buf&rsquo; variable located on the stack. Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code or crash the application, leading to denial of service.</p>
<h2 id="crash-out-phase">Crash Out Phase</h2>
<p>To reproduce the crash let&rsquo;s go to the project website and download the latest version 1.3.</p>
<p>Once we have the tar file, we can run <code>tar xvf XYZ.tar</code></p>
<p>Run:</p>
<pre tabindex="0"><code>./configure
make
./html2xhtml poc.html
</code></pre><p>You should receive a segmentation fault. Let&rsquo;s analyze this with Address Sanitizer.</p>
<p>Run:</p>
<pre tabindex="0"><code>make clean
make CFLAGS=-fsanitize=address
./html2xhtml poc.html
</code></pre><p>Receive the output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">=================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">==</span>3468537<span style="color:#f92672">==</span>ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7fffffffde70 at pc 0x7ffff7493fc4 bp 0x7fffffffdc00 sp 0x7fffffffd3a8
</span></span><span style="display:flex;"><span>READ of size <span style="color:#ae81ff">86</span> at 0x7fffffffde70 thread T0
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#0 0x7ffff7493fc3 in __interceptor_memmem ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:686</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#1 0x5555555f5f35 in read_charset_decl /home/kenny/Downloads/html2xhtml-1.3/src/charset.c:680</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#2 0x5555555f7d89 in guess_charset /home/kenny/Downloads/html2xhtml-1.3/src/charset.c:508</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#3 0x5555555f7d89 in charset_auto_detect /home/kenny/Downloads/html2xhtml-1.3/src/charset.c:343</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#4 0x555555568d49 in main /home/kenny/Downloads/html2xhtml-1.3/src/html2xhtml.c:100</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#5 0x7ffff7029d8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#6 0x7ffff7029e3f in __libc_start_main_impl ../csu/libc-start.c:392</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#7 0x55555556b914 in _start (/home/kenny/Downloads/html2xhtml-1.3/src/html2xhtml+0x17914)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Address 0x7fffffffde70 is located in stack of thread T0 at offset <span style="color:#ae81ff">544</span> in frame
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#0 0x5555555e86bf in read_charset_decl /home/kenny/Downloads/html2xhtml-1.3/src/charset.c:536</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  This frame has <span style="color:#ae81ff">1</span> object<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>32, 544<span style="color:#f92672">)</span> <span style="color:#e6db74">&#39;buf&#39;</span> <span style="color:#f92672">(</span>line 537<span style="color:#f92672">)</span> &lt;<span style="color:#f92672">==</span> Memory access at offset <span style="color:#ae81ff">544</span> overflows this variable
</span></span><span style="display:flex;"><span>HINT: this may be a false positive <span style="color:#66d9ef">if</span> your program uses some custom stack unwind mechanism, swapcontext or vfork
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">(</span>longjmp and C++ exceptions *are* supported<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>SUMMARY: AddressSanitizer: stack-buffer-overflow ../../../../src/libsanitizer/sanitizer_common/sanitizer_common_interceptors.inc:686 in __interceptor_memmem
</span></span><span style="display:flex;"><span>Shadow bytes around the buggy address:
</span></span><span style="display:flex;"><span>  0x10007fff7b70: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7b80: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> f1 f1 f1 f1 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7b90: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7ba0: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7bb0: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 00
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt;0x10007fff7bc0: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> 00<span style="color:#f92672">[</span>f3<span style="color:#f92672">]</span>f3
</span></span><span style="display:flex;"><span>  0x10007fff7bd0: f3 f3 f3 f3 f3 f3 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7be0: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> f1 f1
</span></span><span style="display:flex;"><span>  0x10007fff7bf0: f1 f1 <span style="color:#ae81ff">00</span> f3 f3 f3 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7c00: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  0x10007fff7c10: <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>Shadow byte legend <span style="color:#f92672">(</span>one shadow byte represents <span style="color:#ae81ff">8</span> application bytes<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>  Addressable:           <span style="color:#ae81ff">00</span>
</span></span><span style="display:flex;"><span>  Partially addressable: <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">02</span> <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">05</span> <span style="color:#ae81ff">06</span> <span style="color:#ae81ff">07</span> 
</span></span><span style="display:flex;"><span>  Heap left redzone:       fa
</span></span><span style="display:flex;"><span>  Freed heap region:       fd
</span></span><span style="display:flex;"><span>  Stack left redzone:      f1
</span></span><span style="display:flex;"><span>  Stack mid redzone:       f2
</span></span><span style="display:flex;"><span>  Stack right redzone:     f3
</span></span><span style="display:flex;"><span>  Stack after <span style="color:#66d9ef">return</span>:      f5
</span></span><span style="display:flex;"><span>  Stack use after scope:   f8
</span></span><span style="display:flex;"><span>  Global redzone:          f9
</span></span><span style="display:flex;"><span>  Global init order:       f6
</span></span><span style="display:flex;"><span>  Poisoned by user:        f7
</span></span><span style="display:flex;"><span>  Container overflow:      fc
</span></span><span style="display:flex;"><span>  Array cookie:            ac
</span></span><span style="display:flex;"><span>  Intra object redzone:    bb
</span></span><span style="display:flex;"><span>  ASan internal:           fe
</span></span><span style="display:flex;"><span>  Left alloca redzone:     ca
</span></span><span style="display:flex;"><span>  Right alloca redzone:    cb
</span></span><span style="display:flex;"><span>  Shadow gap:              cc
</span></span><span style="display:flex;"><span><span style="color:#f92672">==</span>3468537<span style="color:#f92672">==</span>ABORTING
</span></span></code></pre></div><h2 id="root-cause-analysis">Root Cause Analysis</h2>
<p>Let&rsquo;s take a look at the source code and review the vulnerable function: read_charset_decl(). The function is over 100 lines of code.
We&rsquo;ll simplify it and take a look at this particular loop.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> ini, len <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> avail <span style="color:#f92672">&amp;&amp;</span> len <span style="color:#f92672">&lt;</span> SCAN_LEN; i <span style="color:#f92672">+=</span> step, len<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    buf[len] <span style="color:#f92672">=</span> <span style="color:#a6e22e">tolower</span>(buffer[i]);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>This loop copies data from the buffer array to buf, converting characters to lower case as it goes. The problem is when avail is greater than SCAN_LEN and the loop does not check for the upper bounds of buf being exceeded.</p>
<p>In order to mitigate there should be bounds checking to make sure len does not exceed SCAN_LEN.</p>
<h1 id="description-of-cve-2024-xxxx">Description of CVE-2024-xxxx</h1>
<p>A stack buffer overflow vulnerability was found in internal/external_link_inline_dumper functions of wiki2md 1.0.0. The vulnerability allows an attacker to overwrite the stack buffer, potentially leading to arbitrary code execution or denial of service.</p>
<h1 id="cve-2024-xxxx">CVE-2024-xxxx</h1>
<p>I discovered a vulnerability in wiki2md in the function internal_link_inline_dumper of dumper.c. C programs are often susceptible to memory corruption vulnerabilities which can be exploited for malicious purposes. Writing secure C code requires careful attention to detail. One way to find memory corruption vulnerability is called &ldquo;fuzz testing&rdquo;.</p>
<p>Fuzz testing is a software testing methodology where a program is supplied with invalid or random data with the intent of revealing or finding vulnerabilities and bugs. This program is used to convert mediawiki syntax docs to markdown format. During the fuzzing process, I discovered a stack based buffer overflow in internal_link_inline_dumper.</p>
<h2 id="finding-the-crash-out">Finding the Crash Out!</h2>
<p>Install wiki2md and compile the program.</p>
<pre tabindex="0"><code>git clone https://github.com/oelmekki/wiki2md
cd wiki2md
make
</code></pre><p>run the program with the proof of concept wiki input.</p>
<pre tabindex="0"><code>./wiki2md poc.wiki
</code></pre><p>You will receive a segfault and the program will crash.</p>
<h3 id="identifying-vuln">Identifying vuln</h3>
<p>If you attach GDB to the program and run with the malicious input. We can see the registers being overwritten by our input. Note that the return pointer was also overwritten.</p>
<p><img src="gdb_trace.png" alt="gdb trace"></p>
<p>This is most likely a stack based buffer overflow but let&rsquo;s modify the makefile with ASAN to confirm the vulnerability.</p>
<p>Add -fsanitize=address -g to our flags and rerun the program with the poc input.</p>
<p>We should receive an output that confirms a buffer overflow vulnerability.</p>
<p><img src="asan.png" alt="asan output"></p>
<h2 id="root-cause-analysis-1">Root Cause Analysis</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span> Generates markdown <span style="color:#66d9ef">for</span> NODE_INTERNAL_LINK.
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span> More parsing is done here to match the various components
</span></span><span style="display:flex;"><span> <span style="color:#f92672">*</span> of the links.
</span></span><span style="display:flex;"><span> <span style="color:#960050;background-color:#1e0010">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">internal_link_inline_dumper</span> (<span style="color:#66d9ef">dumping_params_t</span> <span style="color:#f92672">*</span>params)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> err <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> link_def[MAX_LINK_LENGTH] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>link_ptr <span style="color:#f92672">=</span> link_def;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> link_max_len <span style="color:#f92672">=</span> MAX_LINK_LENGTH;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">size_t</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> params<span style="color:#f92672">-&gt;</span>node<span style="color:#f92672">-&gt;</span>children_len; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">dumping_params_t</span> child_params <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        .node <span style="color:#f92672">=</span> params<span style="color:#f92672">-&gt;</span>node<span style="color:#f92672">-&gt;</span>children[i],
</span></span><span style="display:flex;"><span>        .writing_ptr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>link_ptr,
</span></span><span style="display:flex;"><span>        .start_of_buffer <span style="color:#f92672">=</span> params<span style="color:#f92672">-&gt;</span>start_of_buffer,
</span></span><span style="display:flex;"><span>        .max_len <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>link_max_len,
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      err <span style="color:#f92672">=</span> <span style="color:#a6e22e">dump</span> (<span style="color:#f92672">&amp;</span>child_params);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (err)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">fprintf</span> (stderr, <span style="color:#e6db74">&#34;dumper.c : internal_link_inline_dumper() : error while processing link content.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strlen</span> (link_def) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">fprintf</span> (stderr, <span style="color:#e6db74">&#34;dumper.c : internal_link_inline_dumper() : warning : empty link detected.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">snprintf</span> (link_def, <span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#34;redlink&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>text <span style="color:#f92672">=</span> <span style="color:#a6e22e">strstr</span> (link_def, <span style="color:#e6db74">&#34;|&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> url[MAX_LINK_LENGTH] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> escaped_url[MAX_LINK_LENGTH] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">snprintf</span> (url, (text <span style="color:#f92672">?</span> (<span style="color:#66d9ef">size_t</span>) (text <span style="color:#f92672">-</span> link_def) <span style="color:#f92672">:</span> <span style="color:#a6e22e">strlen</span> (link_def)) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;%s&#34;</span>, link_def);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">escape_url_for_markdown</span> (url, escaped_url);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (text)
</span></span><span style="display:flex;"><span>    text<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>text <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">strlen</span> (text))
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> url;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">size_t</span> out_len <span style="color:#f92672">=</span> <span style="color:#a6e22e">strlen</span> (text) <span style="color:#f92672">+</span> <span style="color:#a6e22e">strlen</span> (escaped_url) <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">snprintf</span> (<span style="color:#f92672">*</span>params<span style="color:#f92672">-&gt;</span>writing_ptr, <span style="color:#f92672">*</span>params<span style="color:#f92672">-&gt;</span>max_len, <span style="color:#e6db74">&#34;[%s](%s.md)&#34;</span>, text, escaped_url);
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>params<span style="color:#f92672">-&gt;</span>writing_ptr <span style="color:#f92672">+=</span> out_len;
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>params<span style="color:#f92672">-&gt;</span>max_len <span style="color:#f92672">-=</span> out_len;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> err;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The length of the string is being subtracted from params-&gt;max_len to record how many bytes are left available, but it does not check if this was more than the max_len. Normally, this is fine when concatenating the buffer but the subtraction is a problem because max_len is a size_t which is unsigned so if it went under 0 then it could be overflowed.</p>

    </div>

    <div class="post-copyright">
        <div class="author">
            <figure class="author-image">
                <a href="/about" class="image" alt="MomoDawg">
                <span class="hidden">About Momo</span></a>
            </figure>
        </div>

        <p class="copyright-item">
            
            <h4>Share This Post:</h4>
            <span class="share-icons">

      

      

      

      
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fmomo1239.github.io%2f2024%2fcve-2024%2f&amp;title=Lame%20ZeroDay%20Research%3a%20Stack%20Based%20Buffer%20Overflow%20in%20CVE-2024-XYZA" target="_blank" title="Share on LinkedIn">
          <i class="iconfont icon-linkedin"></i>
        </a>&nbsp;
        

      

      

      

          

          

          

          
</span>
        </p>
                    

        
    </div>


    <div class="post-tags">
        
        <section>
            <i class="iconfont icon-icon-tag"></i>
            
            &nbsp;&nbsp;<span class="tag"><a href="https://momo1239.github.io/tags/vuln-research/">vuln-research</a></span>
            
            &nbsp;&nbsp;<span class="tag"><a href="https://momo1239.github.io/tags/buffer-overflow/">buffer overflow</a></span>
            
            &nbsp;&nbsp;<span class="tag"><a href="https://momo1239.github.io/tags/memory-corruption/">memory corruption</a></span>
            
        </section>
        
        <section>
                <a href="javascript:window.history.back();">Back</a></span> ¬∑
                <span><a href="https://momo1239.github.io/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://momo1239.github.io/2024/pwnctf/" class="prev" rel="prev" title="BYUCTF PWN Challenge Writeups"><i class="iconfont icon-dajiantou"></i>&nbsp;BYUCTF PWN Challenge Writeups</a>
        
        
    </div>

    <div class="post-comment">
          
          
  


          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="footer-social"> Get in touch: 
<a href="https://github.com/momo1239" target="_blank" rel="me noopener noreferrer"><i class="iconfont icon-github"></i></a>


<a href="https://linkedin.com/in/kenny-nguyen-2a3022152" target="_blank" rel="me noopener noreferrer"><i class="iconfont icon-linkedin"></i></a>























































 </div>
    <div class="copyright" itemscope>
        &copy;
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://momo1239.github.io/">Momo</a> | </span>
         

          <span>üõ†Ô∏è with <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hugo</a> | Based on <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreferrer">KeepIt</a></span>
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.12/css/lightgallery.min.css" rel="stylesheet">
     
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    








     </div>
  </body>
</html>
